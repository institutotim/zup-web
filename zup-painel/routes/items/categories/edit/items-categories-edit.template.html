<div class="loadingRequest" ng-show="processingForm"><img src="assets/images/loading.6be13d2d.gif"></div><div class="blockContent" ng-show="processingForm"></div><div id="full_page"><div class="header"><a href="" ng-click="goBack()" class="back"><span class="glyphicon glyphicon-chevron-left"></span></a> <a class="title" href="" ng-hide="editingCategoryTitle" ng-click="enableEditing()">{{ category.title }}</a><div class="edit_label" ng-show="editingCategoryTitle"><input type="text" id="edit-title-input" ng-model="category.title" on-enter="editingCategoryTitle = false"> <a href="" ng-click="editingCategoryTitle = false">Salvar</a><div class="clearfix"></div></div><div class="divider"></div><a href="" ng-click="editCategoryOptions()" class="edit-information"><span class="glyphicon glyphicon-edit"></span>Alterar ícone e cor</a><div ng-show="showSystemMessage" class="message-status fade-animation" ng-class="systemMessage.messageClass"><p><span class="glyphicon glyphicon-{{ systemMessage.icon }}"></span> {{ systemMessage.text }}</p></div><a href="" ng-click="send()" class="submit_button"><span ng-show="!updating">Cadastrar</span><span ng-show="updating">Salvar</span></a></div><div class="spacing"></div><div class="tabs"><a href="" ng-click="currentTab = 'fields'" ng-class="{'active': currentTab == 'fields'}">Campos</a> <a href="" ng-click="currentTab = 'statuses'" ng-class="{'active': currentTab == 'statuses'}">Estados</a> <a href="" ng-click="currentTab = 'triggers'" ng-class="{'active': currentTab == 'triggers'}" ng-hide="!hasPermission('inventories_formulas_full_access')">Fórmulas</a> <a href="" ng-click="currentTab = 'configs'" ng-class="{'active': currentTab == 'configs'}">Configurações</a></div><div class="big_content" class="pages-animation" ng-hide="currentTab !== 'fields'"><div class="left_column"><div inventory-sortable-sections class="sortableSections"><div class="section" ng-repeat="section in category.sections | orderBy:'position'" inventory-edit-section ng-hide="section.disabled && !showDisabledFields.active"><div class="pending-removal" ng-show="section.destroy"><div class="alert">Atenção! A seção e todos os campos pertencentes a ela serão removidos.</div></div><div class="top_part"><div class="type" inventory-edit-label="section"><a class="name" href="" ng-click="editLabel()" ng-hide="editingSectionLabel">{{ section.title }} <span ng-show="section.required == true">*</span> <span class="label label-danger" ng-show="section.disabled">Seção removida</span></a><div class="edit_label" ng-show="editingSectionLabel"><input type="text" ng-model="label" class="editLabelField"> <a href="" ng-click="saveLabel()">Salvar</a><div class="clearfix"></div></div></div><div class="actions"><div class="option move"><a href="" class="handle icon"><span class="glyphicon glyphicon-move"></span></a></div><div class="option trash"><div class="popover bottom" inventory-popover="remove" ng-show="popover.remove"><div class="arrow"></div><h3 class="popover-title">Remover seção {{ section.title }}</h3><div class="popover-content"><div class="row"><div class="col-xs-6"><a href="" ng-click="popover.remove = false" class="btn btn-default btn-block">Cancelar</a></div><div class="col-xs-6"><a href="" ng-click="section.destroy = true; popover.remove = false" class="btn btn-danger btn-block">Remover</a></div></div></div></div><a href="" ng-click="openPopover('remove')" class="icon" inventory-popover-link ng-hide="section.disabled || section.destroy"><span has-popover class="glyphicon glyphicon-trash"></span></a></div><div class="option permissions"><div class="popover bottom" inventory-popover="permissions" ng-if="popover.permissions"><div class="arrow"></div><h3 class="popover-title">Permissões da seção {{ section.label }}</h3><div class="popover-content"><div class="form-group"><label>Grupos que podem apenas visualizar:</label><ui-select multiple="multiple" ng-model="section.permissions.groups_can_view" ng-disabled="disabled" close-on-select="false" on-select="resetSearchInput($select)" style="width: 300px"><ui-select-match placeholder="Digite um grupo">{{$item.name}}</ui-select-match><ui-select-choices repeat="group.id as group in groups | filter:$select.search">{{group.name}}</ui-select-choices></ui-select></div><div class="form-group"><label>Grupos que podem editar/visualizar:</label><ui-select multiple="multiple" ng-model="section.permissions.groups_can_edit" ng-disabled="disabled" close-on-select="false" on-select="resetSearchInput($select)" style="width: 300px"><ui-select-match placeholder="Digite um grupo">{{$item.name}}</ui-select-match><ui-select-choices repeat="group.id as group in groups | filter:$select.search">{{group.name}}</ui-select-choices></ui-select></div><a href="" ng-click="$parent.popover.permissions = false" class="btn btn-info btn-fat-custom btn-custom pull-right">Pronto</a><div class="clearfix"></div></div></div><a href="" ng-click="openPopover('permissions')" class="icon" inventory-popover-link ng-hide="section.disabled || section.destroy"><span has-popover class="glyphicon glyphicon-lock"></span></a></div><div class="option edit"><div class="popover bottom" inventory-popover="options" ng-show="popover.options"><div class="arrow"></div><h3 class="popover-title">Opções da seção {{ section.title }}</h3><div class="popover-content"><div class="form-group"><label>Preenchimento requerido?</label><br><label class="radio-inline"><input type="radio" ng-model="section.required" ng-change="onChangeSectionRequire(section)" ng-value="true"> Sim</label><label class="radio-inline"><input type="radio" ng-model="section.required" ng-value="false"> Não</label></div><a href="" ng-click="popover.options = false" class="btn btn-info btn-fat-custom btn-custom pull-right">Pronto</a><div class="clearfix"></div></div></div><a href="" ng-click="openPopover('options')" class="icon" inventory-popover-link ng-hide="section.disabled || section.destroy"><span has-popover class="glyphicon glyphicon-edit"></span></a></div><div class="option"><a href="" ng-click="section.destroy = false" class="icon" ng-show="section.destroy"><span class="glyphicon glyphicon-pencil"></span></a></div></div><div class="clearfix"></div></div><div class="middle"><!-- text field --><div inventory-droppable-inputs-area class="droppableInputsArea"><div class="empty_section" ng-show="section.fields.length === 0"><p>Arreste os campos que você deseje adicionar a esta seção</p></div><div class="input pages-animation" ng-repeat="field in section.fields | orderBy:'position'" id="input_{{ field.id }}" ng-hide="field.disabled && !showDisabledFields.active"><div class="type"><div inventory-edit-label ng-hide="field.disabled || field.destroy"><label for="generic_input_{{ field.id }}" class="input_name" ng-hide="editingLabel" ng-click="editLabel()"><span ng-show="field.label !== null">{{ field.label }}</span> <span ng-show="field.label == null">{{ field.title }}</span> <span ng-show="field.required == true">*</span></label><div class="edit_label" ng-show="editingLabel"><input type="text" class="editLabelField" ng-model="label"> <a href="" ng-click="saveLabel()">Salvar</a><div class="clearfix"></div></div></div><label for="generic_input_{{ field.id }}" ng-show="field.disabled"><span ng-show="field.label !== null">{{ field.label }}</span> <span ng-show="field.label == null">{{ field.title }}</span> <span class="label label-danger">Campo removido</span></label><label for="generic_input_{{ field.id }}" ng-show="field.destroy"><span ng-show="field.label !== null">{{ field.label }}</span> <span ng-show="field.label == null">{{ field.title }}</span> <span class="label label-warning">Campo será removido</span></label><div class="clearfix"></div><!-- input type: text, url, email, textarea --><input class="form-control" id="generic_input_{{ field.id }}" type="text" ng-if="field.kind == 'text' || field.kind == 'url' || field.kind == 'email'" disabled="disabled"><!-- textarea --><textarea class="form-control" id="generic_input_{{ field.id }}" type="text" ng-if="field.kind == 'textarea'" disabled="disabled"></textarea><!-- input type date, time, cpf, cnpj --><div class="custom_size col-xs-3" ng-if="field.kind == 'date' || field.kind == 'time' || field.kind == 'cpf' || field.kind == 'cnpj'"><input class="form-control" id="generic_input_{{ field.id }}" type="text" disabled="disabled"></div><!-- input type: integer, decimal --><input class="form-control integer" id="generic_input_{{ field.id }}" type="text" ng-if="field.kind == 'integer' || field.kind == 'decimal'" disabled="disabled"><!-- input type: meters --><div class="input-group col-xs-3" ng-if="field.kind == 'meters'"><input type="text" id="generic_input_{{ field.id }}" class="form-control" type="text" disabled="disabled"> <span class="input-group-addon">metros</span></div><!-- input type: centimeters --><div class="input-group col-xs-3" ng-if="field.kind == 'centimeters'"><input type="text" id="generic_input_{{ field.id }}" class="form-control" type="text" disabled="disabled"> <span class="input-group-addon">cm</span></div><!-- input type: kilometers --><div class="input-group col-xs-3" ng-if="field.kind == 'kilometers'"><input type="text" id="generic_input_{{ field.id }}" class="form-control" type="text" disabled="disabled"> <span class="input-group-addon">km</span></div><!-- input type: years --><div class="input-group col-xs-3" ng-if="field.kind == 'years'"><input type="text" id="generic_input_{{ field.id }}" class="form-control" type="text" disabled="disabled"> <span class="input-group-addon">anos</span></div><!-- input type: months --><div class="input-group col-xs-3" ng-if="field.kind == 'months'"><input type="text" id="generic_input_{{ field.id }}" class="form-control" type="text" disabled="disabled"> <span class="input-group-addon">meses</span></div><!-- input type: days --><div class="input-group col-xs-3" ng-if="field.kind == 'days'"><input type="text" id="generic_input_{{ field.id }}" class="form-control" type="text" disabled="disabled"> <span class="input-group-addon">dias</span></div><!-- input type: hours --><div class="input-group col-xs-3" ng-if="field.kind == 'hours'"><input type="text" id="generic_input_{{ field.id }}" class="form-control" type="text" disabled="disabled"> <span class="input-group-addon">horas</span></div><!-- input type: seconds --><div class="input-group col-xs-3" ng-if="field.kind == 'seconds'"><input type="text" id="generic_input_{{ field.id }}" class="form-control" type="text" disabled="disabled"> <span class="input-group-addon">segundos</span></div><!-- input type: angle --><div class="input-group col-xs-3" ng-if="field.kind == 'angle'"><span class="input-group-addon">ângulo</span> <input type="text" id="generic_input_{{ field.id }}" class="form-control" type="text" disabled="disabled"></div><!-- input type: images --><div ng-if="field.kind == 'images'" class="imagesField"><p>Campo de imagens</p></div><!-- inputs that have multiple options --><div ng-if="kindHasMultipleOptions(field.kind) === true" class="multipleValues"><div class="row"><div class="col-xs-10 selectList"><input class="form-control" type="text" disabled="disabled" placeholder="Selecione um item"><span class="caret"></span></div><div class="col-xs-2 editOptionsLink" ng-hide="field.disabled || field.destroy"><a href="" ng-click="editFieldOptions(field)">Gerenciar opções</a></div></div></div></div><div class="actions"><div class="option move"><a href="" class="handle icon"><span class="glyphicon glyphicon-move"></span></a></div><div class="option trash" ng-hide="!hasPermission('inventories_formulas_full_access') && !hasPermission('inventories_categories_edit', category.id) && !hasPermission('inventories_full_access')"><div class="popover bottom" inventory-popover="remove" ng-if="popover.remove === true"><div class="arrow"></div><h3 class="popover-title">Remover campo {{ field.label }}</h3><div class="popover-content"><div class="row"><div class="col-xs-6"><a href="" ng-click="$parent.popover.remove = false" class="btn btn-default btn-block">Cancelar</a></div><div class="col-xs-6"><a href="" ng-click="field.destroy = true;field.toRemove = true;$parent.popover.remove = false" class="btn btn-danger btn-block">Remover</a></div></div></div></div><a href="" ng-click="openPopover('remove')" class="icon" inventory-popover-link ng-hide="field.disabled || field.destroy"><span has-popover class="glyphicon glyphicon-trash"></span></a></div><div class="option permissions"><div class="popover bottom" inventory-popover="permissions" ng-if="popover.permissions === true"><div class="arrow"></div><h3 class="popover-title">Permissões do campo {{ field.label }}</h3><div class="popover-content"><div class="form-group"><label>Grupos que podem apenas visualizar:</label><ui-select multiple="multiple" ng-model="field.permissions.groups_can_view" ng-disabled="disabled" close-on-select="false" on-select="resetSearchInput($select)" style="width: 300px"><ui-select-match placeholder="Digite um grupo">{{$item.name}}</ui-select-match><ui-select-choices repeat="group.id as group in groups | filter:$select.search">{{group.name}}</ui-select-choices></ui-select></div><div class="form-group"><label>Grupos que podem editar/visualizar:</label><ui-select multiple="multiple" ng-model="field.permissions.groups_can_edit" ng-disabled="disabled" close-on-select="false" on-select="resetSearchInput($select)" style="width: 300px"><ui-select-match placeholder="Digite um grupo">{{$item.name}}</ui-select-match><ui-select-choices repeat="group.id as group in groups | filter:$select.search">{{group.name}}</ui-select-choices></ui-select></div><a href="" ng-click="$parent.popover.permissions = false" class="btn btn-info btn-fat-custom btn-custom pull-right">Pronto</a><div class="clearfix"></div></div></div><a href="" ng-click="openPopover('permissions')" class="icon" inventory-popover-link ng-hide="field.disabled || field.destroy"><span has-popover class="glyphicon glyphicon-lock"></span></a></div><div class="option edit"><div class="popover bottom" inventory-popover="options" ng-show="popover.options"><div class="arrow"></div><h3 class="popover-title">Opções do campo {{ field.label }}</h3><div class="popover-content"><div class="form-group"><label>Preenchimento requerido?</label><br><label class="radio-inline"><input type="radio" ng-model="field.required" ng-value="true"> Sim</label><label class="radio-inline"><input type="radio" ng-model="field.required" ng-change="onChangeFieldRequire(field, section)" ng-value="false"> Não</label></div><div class="form-group"><label>Usar como nome do item?</label><br><label class="radio-inline"><input type="radio" ng-model="field.use_as_title" ng-value="true"> Sim</label><label class="radio-inline"><input type="radio" ng-model="field.use_as_title" ng-value="false"> Não</label></div><div class="row"><div class="col-xs-6"><div class="form-group"><label>{{getLabelForMinField(field.kind)}}</label><input type="number" class="form-control" ng-model="field.minimum"></div></div><div class="col-xs-6"><div class="form-group"><label>{{getLabelForMaxField(field.kind)}}</label><input type="number" class="form-control" ng-model="field.maximum"></div></div></div><a href="" ng-click="popover.options = false; save_use_field_as_title(field)" class="btn btn-info btn-fat-custom btn-custom pull-right">Pronto</a><div class="clearfix"></div></div></div><a href="" ng-click="openPopover('options')" class="icon" inventory-popover-link ng-hide="field.disabled || field.destroy"><span has-popover class="glyphicon glyphicon-edit"></span></a></div><div class="option"><a href="" ng-click="field.destroy = false" class="icon" ng-show="field.destroy"><span class="glyphicon glyphicon-pencil"></span></a></div></div><div class="clearfix"></div></div></div></div></div></div></div><div class="right_column" inputs-sidebar><a class="btn btn-info btn-custom btn-block btn-lg-custom" href="" ng-click="newSection()">+ Adicionar nova seção</a><div class="inputs"><div class="info"><p>Arraste os campos que você deseja adicionar</p></div><div class="clearfix"></div><div class="simple_search"><span class="glyphicon glyphicon-search search_icon"></span> <input type="text" placeholder="Buscar..." ng-model="searchInputs"></div><div class="list"><div class="item" ng-repeat="input in availableInputs | filter: searchInputs" name="{{ input.kind }}" inventory-draggable-input><p>{{ input.name }}</p></div></div></div></div><div class="clearfix"></div></div><div class="big_content" class="pages-animation" ng-if="currentTab === 'statuses'"><div class="toolbar"><div class="pull-left">Obrigatório o uso de estados <input bs-switch type="checkbox" class="pull-right" ng-model="category.require_item_status"></div><a href="" ng-click="newStatus()" class="btn btn-info btn-custom pull-right">+ Novo estado</a><div class="clearfix"></div></div><table class="simple_table"><tr ng-repeat="status in category.statuses" class="pages-animation"><td><b ng-style="{'color': status.color}">{{ status.title }}</b></td><td class="actions"><a class="icon_action" href="" ng-click="editStatus(status)"><span class="glyphicon glyphicon-edit"></span></a> <a class="icon_action" href="" ng-click="removeStatus(status)"><span class="glyphicon glyphicon-trash"></span></a></td></tr></table></div><div class="big_content pages-animation edit-triggers" ng-if="currentTab === 'triggers'" style="padding: 40px"><div class="edit-triggers-header clearfix"><p>{{ triggers.length }} gatilhos criados</p><a href="" ng-click="newTrigger()" class="btn btn-info btn-custom">+ Novo gatilho</a></div><ul><li ng-repeat="trigger in triggers" inventory-trigger><div class="saving" ng-show="processingForm"></div><div class="list-triggers-item" ng-class="{'active': editing == true}"><div class="item-content"><p class="name">Fórmula {{ $index + 1 }}</p><div class="actions" style="width: 60px"><a href="" ng-click="removeTrigger()"><span class="glyphicon glyphicon-trash"></span></a> <a href="" class="right-link" ng-click="editing = false" ng-show="editing"><span class="arrow_icon"></span></a> <a href="" class="right-link" ng-click="editing = true" ng-hide="editing"><span class="arrow_icon"></span></a></div><div class="clearfix"></div></div><table class="item-table" ng-show="editing"><thead ng-hide="trigger.conditions.length == 0"><tr><td width="10%">Tipo</td><td width="30%">Condicionavel</td><td width="25%">Condição</td><td width="30%">Valor</td><td width="5%"></td></tr></thead><tbody><tr ng-repeat="condition in trigger.conditions | filter: onlyActiveTriggers" inventory-trigger-condition category="category"><td><label class="select-trigger"><select class="form-control" ng-model="condition.conditionable_type"><option value="Inventory::Field">Campo</option><option value="Inventory::Analysis">Análises</option></select></label></td><td><label class="select-trigger" ng-if="condition.conditionable_type == 'Inventory::Field'"><select class="multiple-select" style="width: 100%" ui-select2 ng-model="condition.conditionable_id" data-placeholder="Selecione um campo"><option value="">Selecione um campo...</option><optgroup ng-repeat="section in category.sections" label="{{ section.title }}"><option ng-repeat="field in section.fields" ng-value="field.id" ng-show="field.disabled !== true">{{ field.label && field.label || field.title }}</option></optgroup></select></label><label class="select-trigger" ng-if="condition.conditionable_type == 'Inventory::Analysis'"><select class="multiple-select" style="width: 100%" ui-select2 ng-model="condition.conditionable_id" data-placeholder="Selecione uma análise"><option value="">Selecione uma análise...</option><option ng-repeat="analysis in analyzes" ng-value="analysis.id">{{ analysis.title }}</option></select></label></td><td><label class="select-trigger"><select class="form-control" ng-model="condition.operator" ng-options="type.id as type.name for type in types"></select></label></td><td ng-if="condition.field.kind !== 'radio' && condition.field.kind !== 'checkbox' && condition.field.kind !== 'select' && condition.field !== null"><input type="text" class="form-control" placeholder="Digite o valor" ng-model="condition.content"></td><td ng-if="(condition.field.kind === 'radio' || condition.field.kind === 'checkbox' || condition.field.kind === 'select') && condition.field !== null"><select class="multiple-select" style="width: 100%" ui-select2 ng-model="condition.content" data-placeholder="Selecione uma opção" multiple="multiple"><option ng-repeat="option in condition.field.field_options" value="{{ option.id }}">{{ option.value }}</option></select></td><td class="remove-condition"><button type="button" class="remove" ng-click="removeCondition(condition)">x</button></td></tr><tr><td colspan="4" class="new-condition"><a href="" ng-click="newCondition()" class="btn btn-info btn-custom">+ Nova condição</a></td></tr></tbody></table><div class="item-conditions" ng-show="editing"><h3>Caso as condições sejam verdadeiras</h3><form><div class="form-group clearfix"><div class="item-conditions-content"><label for="">Alterar o estado do item para</label><label class="select-trigger"><select class="form-control" ng-model="trigger.inventory_status_id" ng-options="status.id as status.title for status in category.statuses"></select></label></div></div><div class="checkbox"><label><input type="checkbox" ng-model="trigger.run_formula"> Executar fórmula a itens existentes</label></div><div class="save-trigger"><button href="" ng-click="saveTrigger()" class="btn btn-info btn-custom">Salvar gatilho</button></div><div class="clearfix"></div></form></div></div></li></ul></div><div class="big_content pages-animation" ng-if="currentTab === 'configs'" style="padding: 40px"><p>Por padrão essa categoria não é pública, você pode torná-la visível aos munícipes adicionando o grupo <b>Público</b> para ver este inventário.</p><hr><div class="form-group" ng-if="shouldShowGlobalOption()"><label>Categoria Global?</label><p>Se ativado, a categoria será criada na localidade global, se desativado a categoria será criada na localidade atual <strong>({{ namespace.name }})</strong>.</p><div class="clearfix"></div><input type="checkbox" bs-switch ng-model="category.global"><hr></div><div class="form-group"><label>Exibir campos removidos</label><p>Ao ativar esta opção, o sistema irá exibir todos os campos já removidos do sistema. Você não poderá alterar as configurações do campo ou suas opções.</p><div class="clearfix"></div><input type="checkbox" bs-switch ng-model="showDisabledFields.active"></div><hr><div class="form-group"><label>Grupos com permissões para editar</label><div class="selectGroups"><div class="simple_search"><span class="glyphicon glyphicon-search search_icon"></span> <input type="text" placeholder="Buscar grupos..." ng-model="groupCanEdit" ui-autocomplete="groupsCanEditAutocomplete"></div><ul><li ng-repeat="group in category.permissions.groups_can_edit">{{ group.name }} <strong>({{ group.namespace.name }})</strong> <button type="button" class="remove" ng-click="removeGroupCanEdit(group)">×</button></li></ul></div></div><hr><div class="form-group"><label>Grupos com permissões para ver</label><div class="selectGroups"><div class="simple_search"><span class="glyphicon glyphicon-search search_icon"></span> <input type="text" placeholder="Buscar grupos..." ng-model="groupCanView" ui-autocomplete="groupsCanViewAutocomplete"></div><ul><li ng-repeat="group in category.permissions.groups_can_view">{{ group.name }} <strong>({{ group.namespace.name }})</strong> <button type="button" class="remove" ng-click="removeGroupCanView(group)">×</button></li></ul></div></div></div></div>